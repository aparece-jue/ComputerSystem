---
date: 2025-06-23
tags:
  - "#GCC"
---
# GCC
## -g
- 告诉编译器在生成的可执行文件（或者目标文件）里**嵌入调试符号**，以便后续用 `gdb` 、`lldb` 等调试器进行源代码级调试。
- 在 gdb 中你就能直接看到源代码、在任意行设断点、查看局部变量、单步跟踪等
### 具体行为
1. **符号表和源信息**
    - 在编译每个源文件时，`-g` 会把函数名、变量名、类型定义、行号映射（源文件名＋行号）等信息，按 DWARF（默认）或 STABS（可选）格式写入到目标文件的调试节（`.debug_*`）中。
    - 链接生成的最终可执行文件也会保留这些节，使调试器能加载并把机器指令映射回源代码。
    - 对代码生成的机器指令**本身没有影响**，只是在可执行文件里多出调试节（`.debug_*`）。
2. **不改变优化级别**
    - `-g` 只是控制“是否生成调试信息”，不会自动关闭优化。
    - 如果你既要调试又要看最接近发布版的性能行为，常见写法是：
	``` bash
        gcc -O2 -g main.c -o myprog
```   
    - 但请注意，高级别优化（`-O2`、`-O3`）会**重排或内联**代码，可能导致调试时“断点对不上源行”或“变量在寄存器里没地方存”之类现象。   
3. **调试信息等级
    - `-g` 等同于 `-g2`：生成完整的 DWARF2 级别调试信息（包含宏展开信息，但不含所有宏定义）。
    - 你还可以用：
        - `-g0`：不产生调试信息（等同于不加 `-g`）。
        - `-g1`：只生成基本符号表，不包含宏或行号信息，生成的文件更小。
        - `-g3`：在 `-g2` 基础上，额外保留所有宏定义信息，能在调试器里用 `info macro` 看到宏展开细节。
        - `-ggdb`/`-ggdb3`：以 GDB 为目标，生成更丰富的调试信息（有时比标准 DWARF 更详细）。
4. **使用示例**
``` bash
# 生成带调试信息的可执行文件 gcc -g -O0 foo.c bar.c -o myapp
# 用 gdb 调试 
gdb ./myapp
(gdb) break foo.c:42 (gdb) run
```
## -O
- 用来控制优化级别和种类，影响编译器在生成机器码时做哪些变换。
- 使用 `-Og` 编译选项时，编译器会尽量将局部变量（包括函数参数）**保存在栈中**，以便调试器（如 GDB）能够追踪和显示它们的值。
### 常用选项
| 选项       | 含义          | 启用优化（非穷举）                           | 典型用途             |
| -------- | ----------- | ----------------------------------- | ---------------- |
| `-O0`    | 无优化（默认）     | 不做任何优化，保持源码 ↔ 汇编一一对应                | 开发调试阶段           |
| `-Og`    | 调试友好优化      | 常量折叠、死代码删除、基本块合并、寄存器分配等小优化          | 需要调试又要一点性能       |
| `-O1`    | 基本优化        | `-Og` + 局部跳转优化、常量传播、简单内联            | 资源受限场景，轻度性能需求    |
| `-O2`    | 中等优化（推荐发布）  | `-O1` + 全局常量传播、循环重排、跨基本块优化          | 大多数生产环境（平衡速度与尺寸） |
| `-O3`    | 激进优化        | `-O2` + 循环展开、向量化、更多内联               | 对性能极限追求，不在意体积    |
| `-Ofast` | 极限速度（非标准兼容） | `-O3` + 放宽 IEEE/语言标准限制（可忽略 NaN、舍入等） | 科学计算／极端性能，不讲精度   |
| `-Os`    | 体积优化        | `-O2` 去掉增大代码体积的优化（少内联、少展开等）         | 嵌入式／存储受限场景       |
### 相关选项
| 选项                      | 含义                           |
| ----------------------- | ---------------------------- |
| `-funroll-loops`        | 强制循环展开（多用于配合 `-O3`）。         |
| `-finline-functions`    | 强制函数内联。                      |
| `-march=…` / `-mtune=…` | 指定目标 CPU 架构，结合 `-O` 可发挥更好性能。 |
## -S
- 指示编译器“只到**汇编**阶段就停止”，并将每个源文件翻译生成对应的汇编代码文件（后缀 `.s`），**不继续**执行汇编（`as`）和链接（`ld`）步骤。
- 当同时给出多个源文件时，不能使用单个 `-o` 重定向到一个文件；若指定了 `-o`，则只能同时处理一个源文件。
- 以`.`开头的行都是直到汇编器和链接器工作的伪指令。
	- 如何划分节（`.section`、`.text`、`.data`）
	- 定义／导出符号（`.globl`、`.type`、`.size`）
	- 嵌入调试元信息（`.cfi_*` 系列）
	- 放置注释或版本标记（`.ident`、`.note.*`）
	- 对齐／填充（`.align`、`.zero`）
	- 以及其他链接时要用到的属性（`.note.gnu.property`、`.note.GNU-stack`）
## -p
